services:
  ekranchik:
    build: .
    container_name: ekranchik-app
    
    ports:
      - "5000:5000"
    
    volumes:
      # БД - прямой доступ к файлу на хосте
      - D:\KTM\Ekranchik\profiles.db:/app/data/profiles.db
      
      # Фото - прямой доступ к директории на хосте
      - D:\KTM\Ekranchik\static\images:/app/data/images
      
      # Excel папка - прямой доступ (видны временные файлы когда открыт Excel)
      - D:\KTM\Ekranchik\archive\excel:/app/data/excel
      
      # Резервные копии в volume
      - ekranchik-data:/app/data
      
      # Логи приложений
      - ekranchik-logs:/app/logs
      
      # ВНИМАНИЕ: Excel файл на Windows
      # Опция 1 (для локального тестирования): UNC path или смонтированный диск
      # Опция 2 (для production): Используйте строку ниже если диск смонтирован на хосте
      # - /mnt/network-share:/excel:ro
      
      # На Windows Docker Desktop используйте:
      # - type: bind
      #   source: D:\path\to\excel  (путь на Windows хосте)
      #   target: /excel
      #   read_only: true
    
    environment:
      # Flask конфиг
      FLASK_APP: app.py
      FLASK_HOST: 0.0.0.0
      FLASK_PORT: 5000
      FLASK_DEBUG: "false"
      
      # Пути внутри контейнера
      EXCEL_FILE_PATH: /app/data/excel/Учет КПЗ 2025.xlsm
      DB_PATH: /app/data/profiles.db
      PROFILES_DIR: /app/data/images
      
      # Telegram Bot
      TELEGRAM_TOKEN: ${TELEGRAM_TOKEN:-YOUR_TOKEN_HERE}
      FLASK_API_URL: http://localhost:5000
    
    restart: unless-stopped
    
    # Логирование в Docker
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  ekranchik-data:
    driver: local
  ekranchik-logs:
    driver: local
